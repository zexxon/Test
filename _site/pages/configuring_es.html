

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configuring and tuning Elasticsearch &mdash; Graylog 1.2.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Graylog 1.2.0 documentation" href="../index.html"/>
        <link rel="next" title="Sending in log data" href="sending_data.html"/>
        <link rel="prev" title="Manual Setup" href="installation/manual_setup.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Graylog
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architectural considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installing Graylog</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Configuring and tuning Elasticsearch</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuration-of-graylog-server-nodes">Configuration of graylog-server nodes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cluster-name">Cluster Name</a></li>
<li class="toctree-l4"><a class="reference internal" href="#discovery-mode">Discovery mode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-of-elasticsearch-nodes">Configuration of Elasticsearch nodes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#disable-dynamic-scripting">Disable dynamic scripting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#control-access-to-elasticsearch-ports">Control access to Elasticsearch ports</a></li>
<li class="toctree-l4"><a class="reference internal" href="#open-file-limits">Open file limits</a></li>
<li class="toctree-l4"><a class="reference internal" href="#heap-size">Heap size</a></li>
<li class="toctree-l4"><a class="reference internal" href="#merge-throttling">Merge throttling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tuning-elasticsearch">Tuning Elasticsearch</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cluster-status-explained">Cluster Status explained</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#red">RED</a></li>
<li class="toctree-l3"><a class="reference internal" href="#yellow">YELLOW</a></li>
<li class="toctree-l3"><a class="reference internal" href="#green">GREEN</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sending_data.html">Sending in log data</a></li>
<li class="toctree-l1"><a class="reference internal" href="collector.html">Graylog Collector</a></li>
<li class="toctree-l1"><a class="reference internal" href="queries.html">Searching</a></li>
<li class="toctree-l1"><a class="reference internal" href="streams.html">Streams</a></li>
<li class="toctree-l1"><a class="reference internal" href="dashboards.html">Dashboards</a></li>
<li class="toctree-l1"><a class="reference internal" href="extractors.html">Extractors</a></li>
<li class="toctree-l1"><a class="reference internal" href="drools.html">Message rewriting with Drools</a></li>
<li class="toctree-l1"><a class="reference internal" href="blacklisting.html">Blacklisting</a></li>
<li class="toctree-l1"><a class="reference internal" href="load_balancers.html">Load balancer integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="index_model.html">The Graylog index model explained</a></li>
<li class="toctree-l1"><a class="reference internal" href="indexer_failures.html">Indexer failures and dead letters</a></li>
<li class="toctree-l1"><a class="reference internal" href="users_and_roles.html">Users and Roles</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="external_dashboards.html">External dashboards</a></li>
<li class="toctree-l1"><a class="reference internal" href="marketplace.html">Graylog Marketplace</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="ideas_explained.html">The thinking behind the Graylog architecture and why it matters to you</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Graylog</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Configuring and tuning Elasticsearch</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/pages/configuring_es.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configuring-and-tuning-elasticsearch">
<h1>Configuring and tuning Elasticsearch<a class="headerlink" href="#configuring-and-tuning-elasticsearch" title="Permalink to this headline">¶</a></h1>
<p>We strongly recommend to use a dedicated Elasticsearch cluster for your Graylog setup.
If you are using a shared Elasticsearch setup, a problem with indices unrelated to Graylog might turn the cluster status to yellow or red
and impact the availability and performance of your Graylog setup.</p>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="configuration-of-graylog-server-nodes">
<h3>Configuration of graylog-server nodes<a class="headerlink" href="#configuration-of-graylog-server-nodes" title="Permalink to this headline">¶</a></h3>
<p>The most important settings to make a successful connection are the Elasticsearch cluster name and the discovery mode. Graylog is able
to discover the Elasticsearch nodes using multicast. This is great for development and proof of concepts but we recommend to use
classic unicast discovery in production.</p>
<div class="section" id="cluster-name">
<h4>Cluster Name<a class="headerlink" href="#cluster-name" title="Permalink to this headline">¶</a></h4>
<p>You need to tell <code class="docutils literal"><span class="pre">graylog-server</span></code> which Elasticsearch cluster to join. The Elasticsearch cluster default name is <em>elasticsearch</em>
and configured for every Elasticsearch node in its <code class="docutils literal"><span class="pre">elasticsearch.yml</span></code> configuration file with the setting <code class="docutils literal"><span class="pre">cluster.name</span></code>.
Configure the same name in every <code class="docutils literal"><span class="pre">graylog.conf</span></code> as <code class="docutils literal"><span class="pre">elasticsearch_cluster_name</span></code>.
We recommend to call the cluster <code class="docutils literal"><span class="pre">graylog-production</span></code> and not <code class="docutils literal"><span class="pre">elasticsearch</span></code>.</p>
</div>
<div class="section" id="discovery-mode">
<h4>Discovery mode<a class="headerlink" href="#discovery-mode" title="Permalink to this headline">¶</a></h4>
<p>The default discovery mode is multicast. Graylog will try to find other Elasticsearch nodes automatically. This usually works fine
when everything is running on the same system but gets problematic quickly when running in a bigger network topology. We recommend
to use unicast for production setups. Configure Zen unicast discovery in Graylog with the following lines in your configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre># Disable multicast
elasticsearch_discovery_zen_ping_multicast_enabled = false
# List of Elasticsearch nodes to connect to
elasticsearch_discovery_zen_ping_unicast_hosts = es-node-1.example.org:9300,es-node-2.example.org:9300
</pre></div>
</div>
<p>Also make sure to configure <a class="reference external" href="http://www.elastic.co/guide/en/elasticsearch/reference/1.3/modules-discovery-zen.html#unicast">Zen unicast discovery</a> in
the Elasticsearch configuration file by adding the <code class="docutils literal"><span class="pre">discovery.zen.ping.multicast.enabled</span></code> and <code class="docutils literal"><span class="pre">discovery.zen.ping.unicast.hosts</span></code> setting with the
list of Elasticsearch nodes to <code class="docutils literal"><span class="pre">elasticsearch.yml</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>discovery.zen.ping.multicast.enabled: false
discovery.zen.ping.unicast.hosts: [&quot;es-node-1.example.org:9300&quot; , &quot;es-node-2.example.org:9300&quot;]
</pre></div>
</div>
<p>The Elasticsearch default communication port is <em>9300/tcp</em> (not to be confused with the HTTP interface running on port <em>9200/tcp</em> by default).
The communication port can be changed in the Elasticsearch configuration file (<code class="docutils literal"><span class="pre">elasticsearch.yml</span></code>) with the configuration setting <code class="docutils literal"><span class="pre">transport.tcp.port</span></code>.
Make sure that Elasticsearch binds to a network interface that Graylog can connect to (see <code class="docutils literal"><span class="pre">network.host</span></code>).</p>
</div>
</div>
<div class="section" id="configuration-of-elasticsearch-nodes">
<h3>Configuration of Elasticsearch nodes<a class="headerlink" href="#configuration-of-elasticsearch-nodes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="disable-dynamic-scripting">
<h4>Disable dynamic scripting<a class="headerlink" href="#disable-dynamic-scripting" title="Permalink to this headline">¶</a></h4>
<p>Elasticsearch prior to version 1.2 had an insecure default configuration which could lead to a remote code execution.
(see <a class="reference external" href="http://bouk.co/blog/elasticsearch-rce/">here</a> and <a class="reference external" href="https://groups.google.com/forum/#!msg/graylog2/-icrS0rIA-Q/cCTJaNjVrQAJ">here</a> for details)</p>
<p>Make sure to add <code class="docutils literal"><span class="pre">script.disable_dynamic:</span> <span class="pre">true</span></code> to the <code class="docutils literal"><span class="pre">elasticsearch.yml</span></code> file to disable the dynamic scripting feature and
prevent possible remote code executions.</p>
</div>
<div class="section" id="control-access-to-elasticsearch-ports">
<h4>Control access to Elasticsearch ports<a class="headerlink" href="#control-access-to-elasticsearch-ports" title="Permalink to this headline">¶</a></h4>
<p>Since Elasticsearch has no authentication mechanism at time of this writing, make sure to restrict access to the Elasticsearch
ports (default: 9200/tcp and 9300/tcp). Otherwise the data is readable by anyone who has access to the machine over network.</p>
</div>
<div class="section" id="open-file-limits">
<h4>Open file limits<a class="headerlink" href="#open-file-limits" title="Permalink to this headline">¶</a></h4>
<p>Because Elasticsearch has to keep a lot of files open simultaneously it requires a higher open file limit that the usual operating
system defaults allow. <strong>Set it to at least 64000 open file descriptors.</strong></p>
<p>Graylog will show a notification in the web interface when there is a node in the Elasticsearch cluster which has a too low open file limit.</p>
<p>Read about how to raise the open file limit in the corresponding <a class="reference external" href="http://www.elasticsearch.org/tutorials/too-many-open-files/">Elasticsearch documentation page</a>.</p>
</div>
<div class="section" id="heap-size">
<h4>Heap size<a class="headerlink" href="#heap-size" title="Permalink to this headline">¶</a></h4>
<p>It is strongly recommended to raise the standard size of heap memory allocated to Elasticsearch. Just set the <code class="docutils literal"><span class="pre">ES_HEAP_SIZE</span></code> environment
variable to for example <code class="docutils literal"><span class="pre">24g</span></code> to allocate 24GB. We recommend to use around 50% of the available system memory for Elasticsearch (when
running on a dedicated host) to leave enough space for the system caches that Elasticsearch uses a lot.</p>
</div>
<div class="section" id="merge-throttling">
<h4>Merge throttling<a class="headerlink" href="#merge-throttling" title="Permalink to this headline">¶</a></h4>
<p>Elasticsearch is throttling the merging of Lucene segments to allow extremely fast searches. This throttling however has default values
that are very conservative and can lead to slow ingestion rates when used with Graylog. You would see the message journal growing without
a real indication of CPU or memory stress on the Elasticsearch nodes. It usually goes along with Elasticsearch INFO log messages like this:</p>
<div class="highlight-python"><div class="highlight"><pre>now throttling indexing
</pre></div>
</div>
<p>When running on fast IO like SSDs or a SAN we recommend to increase the value of the <code class="docutils literal"><span class="pre">indices.store.throttle.max_bytes_per_sec</span></code> in your
<code class="docutils literal"><span class="pre">elasticsearch.yml</span></code> to 150MB:</p>
<div class="highlight-python"><div class="highlight"><pre>indices.store.throttle.max_bytes_per_sec: 150mb
</pre></div>
</div>
<p>Play around with this setting until you reach the best performance.</p>
</div>
<div class="section" id="tuning-elasticsearch">
<h4>Tuning Elasticsearch<a class="headerlink" href="#tuning-elasticsearch" title="Permalink to this headline">¶</a></h4>
<p>Graylog is already setting specific configuration per index it creates. This is enough tuning for a lot of use cases and setups. A more
detailed guide on deeper tuning of Elasticsearch is following.</p>
</div>
</div>
</div>
<div class="section" id="cluster-status-explained">
<h2>Cluster Status explained<a class="headerlink" href="#cluster-status-explained" title="Permalink to this headline">¶</a></h2>
<p>Elasticsearch provides a classification for the cluster health:</p>
<div class="section" id="red">
<h3>RED<a class="headerlink" href="#red" title="Permalink to this headline">¶</a></h3>
<p>The red status indicates that some or all of the primary shards are not
available. In this state, no searches can be performed until all primary shards
are restored.</p>
</div>
<div class="section" id="yellow">
<h3>YELLOW<a class="headerlink" href="#yellow" title="Permalink to this headline">¶</a></h3>
<p>The yellow status means that all of the primary shards are available but some
or all shard replicas are not.</p>
<p>With only one Elasticsearch node, the cluster state cannot become green because
shard replicas cannot be assigned. This can be solved by adding another
Elasticsearch node to the cluster.</p>
<p>If the cluster is supposed to have only one node it is okay to be in the
yellow state.</p>
</div>
<div class="section" id="green">
<h3>GREEN<a class="headerlink" href="#green" title="Permalink to this headline">¶</a></h3>
<p>The cluster is fully operational. All primary and replica shards are available.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sending_data.html" class="btn btn-neutral float-right" title="Sending in log data" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation/manual_setup.html" class="btn btn-neutral" title="Manual Setup" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015 Graylog, Inc..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>